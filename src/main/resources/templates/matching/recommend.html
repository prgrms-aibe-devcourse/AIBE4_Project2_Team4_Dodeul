<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/base}"
      th:with="title='멘토 선택 | DODEUL'">

<th:block layout:fragment="head">
  <link rel="stylesheet" th:href="@{/css/search/mentor-search.css}"> <link rel="stylesheet" th:href="@{/css/matching/mentor-recommend.css}">   <style>
  .container-wide {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 40px;
  }
  .main.container {
    max-width: 100% !important;
    padding: 0 !important;
  }
</style>
</th:block>

<section layout:fragment="content">

  <div class="recommendation-section">
    <div class="container-wide">
      <div class="text-center">
        <h2 class="fw-bold mb-2">회원님께 딱 맞는 멘토를 찾았어요!</h2>
        <p class="text-secondary">작성하신 상담 신청서를 바탕으로 가장 적합한 멘토 3명을 추천해 드립니다.</p>
      </div>

      <div id="recommendationLoader" class="spinner-area">
        <div class="loading-spinner mb-3"></div>
        <span>최적의 멘토를 분석하고 있습니다...</span>
      </div>

      <div id="recommendationResult"></div>
    </div>
  </div>


  <div class="container-wide pb-5 recommendation-page-search">
    <div class="d-flex align-items-center mb-4">
      <h3 class="fw-bold m-0">직접 멘토 찾기</h3>
      <span class="ms-3 text-secondary text-small">원하는 조건으로 멘토를 검색해보세요.</span>
    </div>

    <th:block th:replace="~{search/fragments/mentor-search-area :: mentorSearch}"></th:block>
  </div>

</section>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    const applicationId = [[${applicationId}]];

    document.addEventListener('DOMContentLoaded', () => {
      loadRecommendedMentors();
    });

    // 추천 멘토 비동기 로딩 함수
    function loadRecommendedMentors() {
      const loader = document.getElementById('recommendationLoader');
      const container = document.getElementById('recommendationResult');

      fetch(`/matchings/${applicationId}/recommendation`)
        .then(response => {
          if (!response.ok) throw new Error('추천 데이터를 불러오지 못했습니다.');
          return response.text();
        })
        .then(html => {
          loader.style.display = 'none';
          container.innerHTML = html;

          container.style.opacity = '0';
          container.style.transition = 'opacity 0.5s';
          setTimeout(() => container.style.opacity = '1', 10);
        })
        .catch(error => {
          console.error(error);
          loader.innerHTML = '<p class="text-danger">추천 목록을 불러오는 중 오류가 발생했습니다.</p>';
        });
    }
  </script>
</th:block>
</html>
