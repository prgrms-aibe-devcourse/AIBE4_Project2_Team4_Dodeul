<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/base}"
      th:with="title='ë©˜í†  ì¶”ì²œ | DODEUL'">
<head>
  <title>ë©˜í†  ì¶”ì²œ | DODEUL</title>
</head>
<body>

<section layout:fragment="content">
  <h1 class="mb-4">í…ŒìŠ¤íŠ¸ìš© ë©˜í†  ëª©ë¡ (DataInitializer ê¸°ë°˜)</h1>

  <div th:if="${applicationId == null}" class="alert alert-danger">
    <strong>ì£¼ì˜!</strong> URL íŒŒë¼ë¯¸í„°ë‚˜ ëª¨ë¸ì— <code>applicationId</code>ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    <br>(ì˜ˆ: ë©˜í‹°1ë¡œ ë¡œê·¸ì¸ í›„, DBì—ì„œ ìƒì„±ëœ "ë§¤ì¹­ ì—†ëŠ” ì‹ ì²­ì„œ" IDë¥¼ í™•ì¸í•˜ì—¬ ì ‘ì†í•˜ì„¸ìš”)
  </div>

  <p th:if="${applicationId}" th:text="|í˜„ì¬ ìƒë‹´ ì‹ ì²­ì„œ ID: ${applicationId}|" class="text-primary fw-bold mb-4"></p>

  <input type="hidden" id="globalApplicationId" th:value="${applicationId}">

  <div class="d-flex flex-wrap gap-4">

    <div class="card-custom text-center p-4 border" style="width: 280px;">
      <span class="badge bg-success mb-2">Case 1</span>
      <h3 class="fw-bold mb-1">MentorClean</h3>
      <p class="text-muted small">Mentor ID: 2</p>
      <p class="text-muted small">Application ID: 10</p>
      <p class="text-muted small">Mentee: mentee1@test.com</p>
      <p class="text-secondary mb-4">
        âœ… <strong>ì„±ê³µ ì˜ˆìƒ</strong><br>
        (ê°€ì¥ í‰ë²”í•œ ë©˜í† )
      </p>
      <button type="button" onclick="requestMatching(2)" class="btn btn-primary w-100">
        ìƒë‹´ ì‹ ì²­
      </button>
    </div>

    <div class="card-custom text-center p-4 border" style="width: 280px;">
      <span class="badge bg-success mb-2">Case 2</span>
      <h3 class="fw-bold mb-1">MentorHistory</h3>
      <p class="text-muted small">Mentor ID: 4</p>
      <p class="text-muted small">Application ID: 11</p>
      <p class="text-muted small">Mentee: mentee1@test.com</p>
      <p class="text-secondary mb-4">
        âœ… <strong>ì„±ê³µ ì˜ˆìƒ</strong><br>
        (ì·¨ì†Œ/ì™„ë£Œ ì´ë ¥ ë§ìŒ)
      </p>
      <button type="button" onclick="requestMatching(4)" class="btn btn-primary w-100">
        ìƒë‹´ ì‹ ì²­
      </button>
    </div>

    <div class="card-custom text-center p-4 border" style="width: 280px;">
      <span class="badge bg-warning text-dark mb-2">Case 3</span>
      <h3 class="fw-bold mb-1">MentorClean</h3>
      <p class="text-muted small">Mentor ID: 2</p>
      <p class="text-muted small">Application ID: 12</p>
      <p class="text-muted small">Mentee: mentee3@test.com</p>
      <p class="text-secondary mb-4">
        ğŸ§ª <strong>ë©˜í‹° í…ŒìŠ¤íŠ¸ìš©</strong><br>
        'MenteeBusy' ë¡œê·¸ì¸ ì‹œ<br>
        âŒ <strong>ì‹¤íŒ¨í•´ì•¼ í•¨</strong>
      </p>
      <button type="button" onclick="requestMatching(6)" class="btn btn-primary w-100">
        ìƒë‹´ ì‹ ì²­
      </button>
    </div>

    <div class="card-custom text-center p-4 border" style="width: 280px;">
      <span class="badge bg-danger mb-2">Case 4</span>
      <h3 class="fw-bold mb-1">MentorDisabled</h3>
      <p class="text-muted small">Mentor ID: 8</p>
      <p class="text-muted small">Application ID: 13</p>
      <p class="text-muted small">Mentee: mentee5@test.com</p>
      <p class="text-secondary mb-4">
        âŒ <strong>ì‹¤íŒ¨ ì˜ˆìƒ</strong><br>
        (ìƒë‹´ ë¶ˆê°€ ìƒíƒœ)
      </p>
      <button type="button" onclick="requestMatching(8)" class="btn btn-primary w-100">
        ìƒë‹´ ì‹ ì²­
      </button>
    </div>

    <div class="card-custom text-center p-4 border" style="width: 280px;">
      <span class="badge bg-danger mb-2">Case 5</span>
      <h3 class="fw-bold mb-1">MentorBusy</h3>
      <p class="text-muted small">Mentor ID: 10</p>
      <p class="text-muted small">Application ID: 14</p>
      <p class="text-muted small">Mentee: mentee5@test.com</p>
      <p class="text-secondary mb-4">
        âŒ <strong>ì‹¤íŒ¨ ì˜ˆìƒ</strong><br>
        (ë©˜í†  í•œë„ ì´ˆê³¼)
      </p>
      <button type="button" onclick="requestMatching(10)" class="btn btn-primary w-100">
        ìƒë‹´ ì‹ ì²­
      </button>
    </div>

  </div>
</section>

<section layout:fragment="script">
  <script th:inline="javascript">
    /**
     * ë§¤ì¹­ ì‹ ì²­ API í˜¸ì¶œ í•¨ìˆ˜
     * @param {number} mentorId - ì‹ ì²­í•  ë©˜í† ì˜ ID
     */
    async function requestMatching(mentorId) {
      const applicationId = document.getElementById('globalApplicationId').value;

      if (!applicationId) {
        showErrorModal('ìƒë‹´ ì‹ ì²­ì„œ IDê°€ ì—†ìŠµë‹ˆë‹¤. ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.');
        return;
      }

      const requestData = {
        applicationId: applicationId,
        mentorId: mentorId
      };

      try {
        const response = await fetch('/api/matchings', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(requestData)
        });

        const result = await response.json();

        if (response.ok) {
          // âœ… ì„±ê³µ ì‹œ: ì•Œë¦¼ ì—†ì´ ì¦‰ì‹œ ëŒ€ê¸° ëª©ë¡ í˜ì´ì§€ë¡œ ì´ë™
          window.location.href = '/matchings/waiting';
        } else {
          // âŒ ì‹¤íŒ¨ ì‹œ: ì—ëŸ¬ ë©”ì‹œì§€ ëª¨ë‹¬ ì¶œë ¥
          showErrorModal(result.message || 'ë§¤ì¹­ ì‹ ì²­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }

      } catch (error) {
        console.error('Network Error:', error);
        showErrorModal('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    function showErrorModal(message) {
      // ì‹¤íŒ¨í–ˆì„ ë•Œë§Œ ì´ ë©”ì‹œì§€ê°€ ëœ¹ë‹ˆë‹¤.
      alert("âš ï¸ ì‹ ì²­ ì‹¤íŒ¨\n\n" + message);
    }
  </script>
</section>

</body>
</html>
