<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/mentee}">

<head>
  <th:block layout:fragment="head">
    <title>DODEUL | ë‚´ê°€ ì“´ í›„ê¸°</title>
    <link rel="stylesheet" href="/css/mypage/dashboard.css">
    <style>
      .cursor-pointer {
        cursor: pointer;
      }

      .tag--selectable {
        cursor: pointer;
        border: none;
        outline: none;
        background-color: #f8f9fa; /* ê¸°ë³¸ ë°°ê²½ìƒ‰ ì¶”ê°€ */
        color: #666;
      }

      .tag--active {
        background-color: var(--color-primary, #0d6efd); /* í™œì„±í™” ìƒ‰ìƒ */
        color: white;
      }

      /* ì¶”ì²œ ìƒíƒœë³„ ë±ƒì§€ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€ */
      .status-badge.recommended {
        background-color: #e8f5e9;
        color: #2e7d32;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }

      .status-badge.not-recommended {
        background-color: #f5f5f5;
        color: #757575;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }
    </style>
  </th:block>
</head>

<body>
<div layout:fragment="page">

  <div class="dashboard-header">
    <h2 class="fw-bold" style="margin-bottom:8px;">ğŸ“ ë‚´ê°€ ì“´ í›„ê¸°</h2>
    <p class="text-small" style="margin-bottom:16px;">ìƒë‹´ í›„ ì‘ì„±í•œ ì†Œì¤‘í•œ í›„ê¸° ëª©ë¡ì…ë‹ˆë‹¤.</p>
  </div>

  <section class="card-custom" style="margin-bottom:16px;">
    <div class="fw-bold" style="margin-bottom:10px;">í•„í„°</div>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button class="tag tag--selectable tag--active" type="button" onclick="filterReviews('all', this)">ì „ì²´</button>
      <button class="tag tag--selectable" type="button" onclick="filterReviews('true', this)">ğŸ‘ ì¶”ì²œí•¨</button>
      <button class="tag tag--selectable" type="button" onclick="filterReviews('false', this)">ì•„ì‰¬ì›Œìš”</button>
    </div>
  </section>

  <section>
    <div class="fw-bold" style="margin-bottom:10px;">í›„ê¸° ëª©ë¡</div>

    <div class="card-custom dashboard-list" style="margin:0;">

      <div th:each="review : ${reviewResponses.content}"
           class="dashboard-row cursor-pointer review-item"
           th:data-rec="${review.isRecommended}"
           th:data-mentor="${review.mentorNickname}"
           th:data-content="${review.content}"
           onclick="openModal(this)">

        <div>
          <div class="dashboard-row-title" style="margin-bottom: 0;">
            <span th:text="${review.mentorNickname} + ' ë©˜í† ë‹˜'">ë©˜í† ì´ë¦„</span>
          </div>
        </div>

        <div class="dashboard-row-right">
          <span th:if="${review.isRecommended}" class="status-badge recommended">ğŸ‘ ì¶”ì²œí•¨</span>
          <span th:unless="${review.isRecommended}" class="status-badge not-recommended">ì•„ì‰¬ì›Œìš”</span>
          <div class="text-small text-secondary" style="margin-left: 12px;"
               th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">2026-01-13
          </div>
        </div>
      </div>

      <div th:if="${reviewResponses.isEmpty()}" class="dashboard-row justify-content-center py-5">
        <div class="text-center text-secondary">
          <i class="bi bi-chat-square-text fs-1 mb-3 d-block"></i>
          ì‘ì„±í•œ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </section>

  <nav th:if="${reviewResponses.totalPages > 0}" aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center" style="gap: 5px;">

      <li class="page-item" th:classappend="${reviewResponses.first} ? 'disabled'">
        <a class="page-link border-0" th:href="@{/mentee/reviews(page=${reviewResponses.number - 1})}">&laquo;</a>
      </li>

      <li th:each="pageNum : ${#numbers.sequence(0, reviewResponses.totalPages - 1)}"
          class="page-item"
          th:classappend="${pageNum == reviewResponses.number} ? 'active'">
        <a class="page-link border-0 rounded"
           th:href="@{/mentee/reviews(page=${pageNum})}"
           th:text="${pageNum + 1}">1</a>
      </li>

      <li class="page-item" th:classappend="${reviewResponses.last} ? 'disabled'">
        <a class="page-link border-0"
           th:href="@{/mentee/reviews(page=${reviewResponses.number + 1})}">&raquo;</a>
      </li>

    </ul>
  </nav>

  <div class="modal fade" id="reviewDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title fw-bold">ë¦¬ë·° ìƒì„¸</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body py-4">
          <div class="mb-3">
            <span class="text-secondary">ëŒ€ìƒ ë©˜í† : </span>
            <span id="mTarget" class="fw-bold"></span>
            <span id="mBadge" class="ms-2"></span>
          </div>
          <div class="p-3 bg-light rounded-3 shadow-sm">
            <p id="mContent" class="mb-0" style="white-space: pre-wrap; line-height: 1.6; word-break: break-all;"></p>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-primary-custom px-4" data-bs-dismiss="modal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </div>

</div>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    /**
     * ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ (ìˆ˜ì •ë¨: ìš”ì†Œì˜ datasetì—ì„œ ê°’ì„ ê°€ì ¸ì˜´)
     */
    function openModal(element) {
      // data-ì†ì„±ì—ì„œ ê°’ ì¶”ì¶œ
      const name = element.getAttribute('data-mentor');
      const content = element.getAttribute('data-content');
      const isRec = element.getAttribute('data-rec') === 'true'; // ë¬¸ìì—´ 'true' ë¹„êµ

      // ëª¨ë‹¬ ë‚´ìš© ì±„ìš°ê¸°
      document.getElementById('mTarget').textContent = name;
      document.getElementById('mContent').textContent = content;

      const badgeArea = document.getElementById('mBadge');
      badgeArea.innerHTML = isRec
        ? '<span class="status-badge recommended" style="font-size:11px;">ğŸ‘ ì¶”ì²œí•¨</span>'
        : '<span class="status-badge not-recommended" style="font-size:11px;">ì•„ì‰¬ì›Œìš”</span>';

      // ëª¨ë‹¬ ë„ìš°ê¸°
      new bootstrap.Modal(document.getElementById('reviewDetailModal')).show();
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§
     */
    function filterReviews(type, btn) {
      // íƒœê·¸ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.tag--selectable').forEach(b => b.classList.remove('tag--active'));
      btn.classList.add('tag--active');

      const items = document.querySelectorAll('.review-item');
      items.forEach(item => {
        const isRec = item.getAttribute('data-rec'); // data-rec ì†ì„± ì‚¬ìš©
        if (type === 'all' || isRec === type) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }

    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
      // Controllerì—ì„œ RedirectAttributesë¡œ ë³´ë‚¸ ë©”ì‹œì§€ ì²˜ë¦¬
      const errorMessage = /*[[${errorMessage}]]*/ null;
      if (errorMessage) {
        alert(errorMessage);
      }
    });
    /*]]>*/
  </script>
</th:block>

</body>
</html>
