<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout/mentee}">

<head>
  <th:block layout:fragment="head">
    <title>DODEUL | ë‚´ê°€ ì“´ í›„ê¸°</title>
    <link rel="stylesheet" href="/css/mypage/dashboard.css">
    <style>
      .cursor-pointer { cursor: pointer; }
      .tag--selectable { cursor: pointer; border: none; outline: none; }
      /* ì¶”ì²œ ìƒíƒœë³„ ë±ƒì§€ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í…€ */
      .status-badge.recommended { background-color: #e8f5e9; color: #2e7d32; }
      .status-badge.not-recommended { background-color: #f5f5f5; color: #757575; }
    </style>
  </th:block>
</head>

<body>
<div layout:fragment="page">

  <div class="dashboard-header">
    <h2 class="fw-bold" style="margin-bottom:8px;">ğŸ“ ë‚´ê°€ ì“´ í›„ê¸°</h2>
    <p class="text-small" style="margin-bottom:16px;">ìƒë‹´ í›„ ì‘ì„±í•œ ì†Œì¤‘í•œ í›„ê¸° ëª©ë¡ì…ë‹ˆë‹¤.</p>
  </div>

  <section class="card-custom" style="margin-bottom:16px;">
    <div class="fw-bold" style="margin-bottom:10px;">í•„í„°</div>
    <div style="display:flex; gap:8px; flex-wrap:wrap;">
      <button class="tag tag--selectable tag--active" type="button" onclick="filterReviews('all', this)">ì „ì²´</button>
      <button class="tag tag--selectable" type="button" onclick="filterReviews('true', this)">ğŸ‘ ì¶”ì²œí•¨</button>
      <button class="tag tag--selectable" type="button" onclick="filterReviews('false', this)">ì•„ì‰¬ì›Œìš”</button>
    </div>
  </section>

  <section>
    <div class="fw-bold" style="margin-bottom:10px;">í›„ê¸° ëª©ë¡</div>

    <div class="card-custom dashboard-list" style="margin:0;">
      <div th:each="review : ${reviewResponses.content}"
           class="dashboard-row cursor-pointer review-item"
           th:data-recommended="${review.isRecommended}"
           th:onclick="showReviewModal([[${review.mentorNickname}]], [[${review.content}]], [[${review.isRecommended}]])">
        <div>
          <div class="dashboard-row-title" th:text="${review.mentorNickname} + ' ë©˜í† ë‹˜'">ë©˜í† ì´ë¦„</div>
          <div class="dashboard-row-sub"
               th:text="${#strings.abbreviate(review.content, 40)}">ë‚´ìš© ìš”ì•½...</div>
        </div>
        <div class="dashboard-row-right">
          <span th:if="${review.isRecommended}" class="status-badge recommended">ğŸ‘ ì¶”ì²œí•¨</span>
          <span th:unless="${review.isRecommended}" class="status-badge not-recommended">ì•„ì‰¬ì›Œìš”</span>
          <div class="text-small text-secondary" style="margin-left: 12px;"
               th:text="${#temporals.format(review.createdAt, 'yyyy-MM-dd')}">2026-01-13</div>
        </div>
      </div>

      <div th:if="${reviewResponses.isEmpty()}" class="dashboard-row">
        <div class="text-small">ì‘ì„±í•œ í›„ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      </div>
    </div>
  </section>

  <nav th:if="${!reviewResponses.isEmpty()}" aria-label="Page navigation" class="mt-4">
    <ul class="pagination justify-content-center" style="gap: 5px;">
      <li class="page-item" th:classappend="${reviewResponses.first} ? 'disabled'">
        <a class="page-link border-0" th:href="@{/mypage/mentee/reviews(page=${reviewResponses.number - 1})}">&laquo;</a>
      </li>
      <li th:each="pageNum : ${#numbers.sequence(0, reviewResponses.totalPages - 1)}"
          class="page-item" th:classappend="${pageNum == reviewResponses.number} ? 'active'">
        <a class="page-link border-0 rounded" th:href="@{/mypage/mentee/reviews(page=${pageNum})}" th:text="${pageNum + 1}">1</a>
      </li>
      <li class="page-item" th:classappend="${reviewResponses.last} ? 'disabled'">
        <a class="page-link border-0" th:href="@{/mypage/mentee/reviews(page=${reviewResponses.number + 1})}">&raquo;</a>
      </li>
    </ul>
  </nav>

  <div class="modal fade" id="reviewDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow">
        <div class="modal-header border-0 pb-0">
          <h5 class="modal-title fw-bold">ë¦¬ë·° ìƒì„¸</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body py-4">
          <div class="mb-3">
            <span class="text-secondary">ëŒ€ìƒ ë©˜í† : </span>
            <span id="mTarget" class="fw-bold"></span>
            <span id="mBadge" class="ms-2"></span>
          </div>
          <div class="p-3 bg-light rounded-3 shadow-sm">
            <p id="mContent" class="mb-0" style="white-space: pre-wrap; line-height: 1.6;"></p>
          </div>
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-primary-custom px-4" data-bs-dismiss="modal">ë‹«ê¸°</button>
        </div>
      </div>
    </div>
  </div>

</div>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    /**
     * ìƒì„¸ ëª¨ë‹¬ í‘œì‹œ
     */
    function showReviewModal(name, content, isRec) {
      document.getElementById('mTarget').textContent = name;
      document.getElementById('mContent').textContent = content;

      const badgeArea = document.getElementById('mBadge');
      badgeArea.innerHTML = isRec
        ? '<span class="status-badge recommended" style="font-size:11px;">ğŸ‘ ì¶”ì²œí•¨</span>'
        : '<span class="status-badge not-recommended" style="font-size:11px;">ì•„ì‰¬ì›Œìš”</span>';

      new bootstrap.Modal(document.getElementById('reviewDetailModal')).show();
    }

    /**
     * í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ í•„í„°ë§ (í˜„ì¬ í˜ì´ì§€ ë‚´ ë°ì´í„° ê¸°ì¤€)
     */
    function filterReviews(type, btn) {
      // íƒœê·¸ í™œì„±í™” ìƒíƒœ ë³€ê²½
      document.querySelectorAll('.tag--selectable').forEach(b => b.classList.remove('tag--active'));
      btn.classList.add('tag--active');

      const items = document.querySelectorAll('.review-item');
      items.forEach(item => {
        const isRec = item.getAttribute('data-recommended');
        if (type === 'all' || isRec === type) {
          item.style.display = 'flex';
        } else {
          item.style.display = 'none';
        }
      });
    }
  </script>
</th:block>

</body>
</html>
